<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SQL Deployment Manager</title>
  <style>
    body { font-family: Arial; margin: 20px; background: #f4f4f4; }
    h1 { color: #333; }
    .section { margin-bottom: 30px; padding: 20px; background: #fff; border-radius: 8px; box-shadow: 0 0 5px #ccc; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    .btn { padding: 10px 20px; background: #0078d4; color: white; border: none; border-radius: 5px; cursor: pointer; }
    .btn:hover { background: #005fa3; }
    .log { font-size: 14px; background: #eee; padding: 10px; border-radius: 5px; }
  </style>
</head>
<body>

  <h1>SQL Deployment Manager</h1>

  <div class="section" id="diffView">
    <h2>Schema Comparison (Diff View)</h2>
    <button class="btn" onclick="compareSchemas()">Compare Schemas</button>
    <div id="diffResult"></div>
  </div>

  <div class="section" id="codeAnalysis">
    <h2>SQL Code Analysis</h2>
    <textarea id="sqlInput" rows="5" style="width:100%;">SELECT * FROM users WHERE name = 'John';</textarea><br><br>
    <button class="btn" onclick="analyzeSQL()">Analyze SQL</button>
    <div id="analysisResult"></div>
  </div>

  <div class="section" id="deploymentWorkflow">
    <h2>Deployment Workflow</h2>
    <button class="btn" onclick="deployToEnv('Test')">Deploy to Test</button>
    <button class="btn" onclick="deployToEnv('Production')">Deploy to Production</button>
    <div id="deployStatus"></div>
  </div>

  <div class="section" id="history">
    <h2>Deployment History</h2>
    <div id="historyLog" class="log"></div>
  </div>

  <div class="section" id="aiSuggestions">
    <h2>AI Suggestions</h2>
    <ul>
      <li>Consider indexing the <code>name</code> column in <code>users</code>.</li>
      <li>Rollback to schema_v1 if deployment fails.</li>
      <li>Release note: “Added email field to users table.”</li>
    </ul>
  </div>

  <script>
    const schema_v1 = {
      users: { id: "INT", name: "VARCHAR(100)" },
      orders: { id: "INT", amount: "DECIMAL(10,2)" }
    };

    const schema_v2 = {
      users: { id: "INT", name: "VARCHAR(100)", email: "VARCHAR(255)" },
      orders: { id: "INT", amount: "DECIMAL(10,2)", status: "VARCHAR(20)" }
    };

    const history = [];

    function compareSchemas() {
      let result = "<table><tr><th>Table</th><th>Field</th><th>Change</th></tr>";
      for (let table in schema_v2) {
        for (let field in schema_v2[table]) {
          if (!schema_v1[table] || !schema_v1[table][field]) {
            result += `<tr><td>${table}</td><td>${field}</td><td>Added</td></tr>`;
          }
        }
      }
      document.getElementById("diffResult").innerHTML = result + "</table>";
    }

    function analyzeSQL() {
      const sql = document.getElementById("sqlInput").value;
      let feedback = "<ul>";
      if (sql.includes("SELECT *")) {
        feedback += "<li>❌ Avoid using SELECT * — it's inefficient.</li>";
      }
      if (!sql.includes("INDEX")) {
        feedback += "<li>⚠️ Consider indexing the WHERE clause column.</li>";
      }
      feedback += "</ul>";
      document.getElementById("analysisResult").innerHTML = feedback;
    }

    function deployToEnv(env) {
      const success = env === "Test";
      const log = {
        timestamp: new Date().toLocaleString(),
        env,
        status: success ? "Success" : "Failed",
        changes: ["Added email to users"],
        error: success ? null : "Missing index on name"
      };
      history.push(log);
      document.getElementById("deployStatus").innerHTML = `<p>Deployment to ${env}: <strong>${log.status}</strong></p>`;
      updateHistory();
    }

    function updateHistory() {
      let logText = "";
      history.forEach(entry => {
        logText += `${entry.timestamp} → ${entry.env} → ${entry.status}`;
        if (entry.error) logText += ` ⚠️ Error: ${entry.error}`;
        logText += "<br>";
      });
      document.getElementById("historyLog").innerHTML = logText;
    }
  </script>

</body>
</html>